import sys
import logging
from scanner import MalwareScanner
from classifier import MalwareClassifier
from report_generator import generate_json_report, generate_html_report, display_terminal_report

# Configure logging
logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s")

if len(sys.argv) < 2:
    print("Usage: python run_scanner.py <file_path1> [file_path2 ...]")
    sys.exit(1)

file_paths = sys.argv[1:]

for file_path in file_paths:
    logging.info(f"Starting scan for: {file_path}")

    try:
        scanner = MalwareScanner(file_path)
        scan_results = scanner.analyze()

        if not scan_results:
            logging.error(f"Failed to analyze {file_path}. Skipping...")
            continue

        classifier = MalwareClassifier()
        classification_results = classifier.classify(scan_results)

        # Generate reports
        json_report = f"{file_path}.json"
        html_report = f"{file_path}.html"
        generate_json_report(scan_results, classification_results, output_file=json_report)
        generate_html_report(scan_results, classification_results, output_file=html_report)

        # Display results in the terminal
        display_terminal_report(scan_results, classification_results)

        logging.info(f"Scan completed for: {file_path}")

    except Exception as e:
        logging.error(f"Error scanning {file_path}: {e}")