import json
from rich.console import Console
from rich.table import Table

def generate_json_report(scan_results, classification_results, output_file="report.json"):
    """Saves scan results as a JSON file."""
    data = {
        "scan_results": scan_results,
        "classification_results": classification_results
    }
    with open(output_file, "w") as f:
        json.dump(data, f, indent=4)
    print(f"[INFO] JSON report saved as {output_file}")

def generate_html_report(scan_results, classification_results, output_file="report.html"):
    """Saves scan results as an HTML file."""
    html_content = f"""
    <html>
    <head><title>Malware Scan Report</title></head>
    <body>
        <h1>Malware Scan Report</h1>
        <h2>Scan Results</h2>
        <pre>{json.dumps(scan_results, indent=4)}</pre>
        <h2>Classification Results</h2>
        <pre>{json.dumps(classification_results, indent=4)}</pre>
    </body>
    </html>
    """
    with open(output_file, "w") as f:
        f.write(html_content)
    print(f"[INFO] HTML report saved as {output_file}")

def display_terminal_report(scan_results, classification_results):
    """Displays scan results in a formatted table."""
    console = Console()
    table = Table(title="Malware Scan Report")

    table.add_column("Category", style="cyan", justify="left")
    table.add_column("Details", style="white")

    for key, value in scan_results.items():
        table.add_row(key, str(value))

    table.add_row("Risk Score", str(classification_results["Risk Score"]))
    console.print(table)

    if classification_results["Risk Score"] > 5:
        console.print("[bold red]⚠️ HIGH RISK: Potential malware detected![/bold red]")